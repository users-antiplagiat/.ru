$(document).ready((function(){function e(){var e=null;c&&(e=grecaptcha.getResponse(a.find(".g-recaptcha").data("widgetid")));var i=$.toJSON({Email:$.trim(r.val()),Captcha:e}),n=$("#__AjaxAntiForgeryForm").find("input[name='__RequestVerificationToken']").val();$.ajax({type:"POST",url:"/account/passwordRecovery",data:i,dataType:"json",beforeSend:function(e){e.setRequestHeader("X-RequestVerificationToken",n)},contentType:"application/json; charset=utf-8",success:function(e){(t=!1,s.removeAttr("disabled").text($.localize("Restore","~/js/area/account/passwordRecovery.js")),e.success)?(a.dialog("close"),(new DialogHelper).modalHtml('<p class="complete">'+$.localize("Password has been sent.","~/js/area/account/passwordRecovery.js")+"</p>",null,null,"ap-header-dialog"),setYMMainCounter("recover_pass_form_message"),setGAMainCounter("recover_form","message_sent")):(c&&grecaptcha.reset(a.find(".g-recaptcha").data("widgetid")),o.html(e.message).show())},error:function(e,i,o){t=!1,s.removeAttr("disabled").text($.localize("Restore","~/js/area/account/passwordRecovery.js")),500==e.status&&window.location.reload(!0),a.dialog("close"),(new DialogHelper).modalText($.localize("Failed to restore password.","~/js/area/account/passwordRecovery.js"),null,null,"ap-header-dialog")}})}var t=!1,a=$("#dialog-password-recovery"),i=$("#dialog-enter"),o=a.find(".alert-error").hide(),n=a.find(".alert-success").hide(),r=a.find("input[name='PasswordRecovery.Email']"),s=a.find(".password-recovery-button > button"),c="undefined"!=typeof $showAccountCaptcha&&$showAccountCaptcha;$(document).on("click",".ap-dialog-password-recovery .ui-dialog-title .manual",(function(e){setYMMainCounter("recover_pass_form_manual"),setGAMainCounter("recover_form","email_typing")})),r.on("change",(function(e){setYMMainCounter("recover_pass_form_email_typing"),setGAMainCounter("login_form","email_typing")})),a.dialog({autoOpen:!1,resizable:!1,modal:!0,draggable:!1,autoresize:!0,dialogClass:"ap-header-dialog ap-dialog-confirm ap-dialog-password-recovery",buttons:[],open:function(){jQuery(".ui-widget-overlay").bind("click",(function(){t||a.dialog("close")})),r.val("").removeClass("ok").focus()},create:function(){c&&(s.on("captchaSuccess",e),s.on("captchaError",(function(){o.text($.localize("Captcha error","~/js/area/account/passwordRecovery.js")).show(),s.removeAttr("disabled").text($.localize("Restore","~/js/area/account/passwordRecovery.js")),t=!1})),s.on("captchaReset",(function(){s.removeAttr("disabled").text($.localize("Restore","~/js/area/account/passwordRecovery.js")),t=!1})))},beforeClose:function(){if(t)return!1},close:function(){o.text("").hide(),n.text("").hide(),c&&grecaptcha.reset(a.find(".g-recaptcha").data("widgetid"))},width:520,closeText:$.localize("Close","~/js/area/account/passwordRecovery.js")}),$(document).on("click",".dialog-login .recover-passwd, .dialog-registration .recover-passwd",(function(e){e.preventDefault(),e.stopPropagation(),t||($(this).closest(".dialog-login").length>0&&(setYMMainCounter("autho_form_recover_pass"),setGAMainCounter("login_form","recover_pass")),o.text("").hide(),n.text("").hide(),i.dialog("close"),a.dialog("open"))})),r.on("input",(function(){t||function(){o.text("").hide();var e=validateEmail($.trim(r.val()));r.toggleClass("ok",e)}()})),s.click((function(i){return i.preventDefault(),setYMMainCounter("recover_pass_form_apply"),setGAMainCounter("recover_form","apply"),o.text("").hide(),n.text("").hide(),validateEmail($.trim(r.val()))?t?void 0:(t=!0,s.attr("disabled","disabled").text($.localize("Sending letter...","~/js/area/account/passwordRecovery.js")),c?grecaptcha.execute(a.find(".g-recaptcha").data("widgetid")):e(),!1):void o.html($.localize("Wrong email.","~/js/area/account/passwordRecovery.js")).show()}))})),$(document).ready((function(){function e(){var e=null;x&&(e=grecaptcha.getResponse(n.find(".dialog-registration .g-recaptcha").data("widgetid")));var t=$.toJSON({Email:$.trim(c.val()),Captcha:e,AcceptLicence:d.length>0?d.is(":checked"):"",AdsSending:u.is(":checked"),ReturnUrl:$loginReturnUrl}),a=$("#__AjaxAntiForgeryForm").find("input[name='__RequestVerificationToken']").val();$.ajax({type:"POST",url:"/account/register",data:t,dataType:"json",beforeSend:function(e){e.setRequestHeader("X-RequestVerificationToken",a)},contentType:"application/json; charset=utf-8",success:function(e){x&&grecaptcha.reset(n.find(".dialog-registration .g-recaptcha").data("widgetid")),o=!1,l.removeAttr("disabled").text($.localize("Sign up","~/js/area/account/register.js")),e.success?(function(){w.tabs("option","active",0);var e=$.trim(c.val());c.val("").removeClass("ok"),h.val(e).addClass("ok"),f.attr("disabled","disabled"),v.hide(),_.css("pointer-events","none")}(),r.text("").hide(),r.text("").hide(),g.text("").hide(),p.text(e.message).show()):(g.text("").hide(),p.text("").hide(),s.text("").hide(),"not verified"==e.status?r.html(e.message+" <a href='#' class='not-verified' title='"+$.localize("Send another","~/js/area/account/register.js")+"'>"+$.localize("Send another","~/js/area/account/register.js")+"</a>?"):"already in use"==e.status?r.html(e.message+" "+$.localize("You can push","~/js/area/account/register.js")+" <a href='#' class='already-in-use' title='"+$.localize("enter","~/js/area/account/register.js")+"'>"+$.localize("enter","~/js/area/account/register.js")+"</a>, <a href='#' class='recover-passwd' title='"+$.localize("restore password","~/js/area/account/register.js")+"'>"+$.localize("restore password","~/js/area/account/register.js")+"</a> "+$.localize("or enter another e-mail","~/js/area/account/register.js")+"."):r.html(e.message),r.show())},error:function(e,t,a){o=!1,l.removeAttr("disabled").text($.localize("Sign up","~/js/area/account/register.js")),500==e.status&&window.location.reload(!0),n.dialog("close"),(new DialogHelper).modalText("User registration failed.",null,null,"ap-header-dialog")}})}function t(){var e=null;x&&(e=grecaptcha.getResponse(n.find(".dialog-registration .g-recaptcha").data("widgetid")));var t=$.toJSON({Email:$.trim(c.val()),Captcha:e}),i=$("#__AjaxAntiForgeryForm").find("input[name='__RequestVerificationToken']").val();$.ajax({type:"POST",url:"/account/sendPassword",data:t,dataType:"json",beforeSend:function(e){e.setRequestHeader("X-RequestVerificationToken",i)},contentType:"application/json; charset=utf-8",success:function(e){x&&grecaptcha.reset(n.find(".dialog-registration .g-recaptcha").data("widgetid")),o=!1,l.removeAttr("disabled").text($.localize("Sign up","~/js/area/account/register.js")),e.success?(a(),r.text("").hide(),r.text("").hide(),g.text("").hide(),p.text(e.message).show()):(g.text("").hide(),p.text("").hide(),s.text("").hide(),r.text(e.message).show())},error:function(e,t,a){o=!1,l.removeAttr("disabled").text($.localize("Sign up","~/js/area/account/register.js")),500==e.status&&window.location.reload(!0),n.dialog("close"),(new DialogHelper).modalText("Error resending email.",null,null,"ap-header-dialog")}})}function a(e){f.removeAttr("disabled"),v.show(),_.css("pointer-events",""),w.tabs("option","active",0);var t=$.trim(c.val());c.val("").removeClass("ok"),h.val(t).addClass("ok"),m.val("").attr("type","password").focus(),f.removeAttr("disabled")}function i(){r.text("").hide();var e=validateEmail($.trim(c.val()));0==d.length||d.is(":checked")?l.removeAttr("disabled"):l.attr("disabled","disabled"),c.toggleClass("ok",e)}var o=!1,n=$("#dialog-enter"),r=(n.find(".loading"),n.find(".dialog-registration .alert-error")),s=n.find(".dialog-registration .alert-success"),c=n.find('.dialog-registration input[name="Registration.Email"]'),l=n.find(".dialog-registration .registration-button > button"),d=n.find(".dialog-registration #accept-licence"),u=n.find(".dialog-registration #ads-sending"),g=n.find(".dialog-login .alert-error"),p=n.find(".dialog-login .alert-success"),h=n.find('.dialog-login input[name^="Login.Email"]'),f=n.find(".dialog-login .login-button > button"),m=n.find('.dialog-login input[name^="Login.Password"]'),v=$(".passwd-zone"),w=$(".dialog-enter #tabs"),_=n.find("#tabs > ul > li:nth-child(2)"),x="undefined"!=typeof $showAccountCaptcha&&$showAccountCaptcha,j=!1;i(),$(".ap-dialog-enter-tabs .ui-tabs-nav li:eq(1)").click((function(e){setYMMainCounter("registration_form_to_autho")})),$(".ap-dialog-enter-tabs .ui-tabs-nav li:eq(1) .manual").click((function(e){setYMMainCounter("autho_form_signin_man"),setGAMainCounter("autho_form","signin_manual")})),c.on("change",(function(e){setYMMainCounter("registration_form_email_typing"),setGAMainCounter("registration_form","email_typing")})),d.on("click",(function(e){setYMMainCounter("registration_form_agree")})),d.find('~label > a[href$="/terms"]').on("click",(function(e){setYMMainCounter("registration_form_to_user_agree"),setGAMainCounter("registration_form","to_user_agree")})),d.find('~label > a[href$="/privacy"]').on("click",(function(e){setYMMainCounter("registration_form_to_data_agree"),setGAMainCounter("registration_form","to_data_agree")})),n.find('.dialog-registration input[type="checkbox"]'),$(".enter .registration, .section-access a.btn-submit").click((function(e){e.preventDefault(),e.stopPropagation(),o||($(this).is(".btn-submit")?(setYMMainCounter("signin_footer"),setGAMainCounter("login_signin","signin","footer")):$(this).is(".registration")&&(setYMMainCounter("signin_top"),setGAMainCounter("login_signin","signin","top")),w.tabs("option","active",1),g.text("").hide(),p.text("").hide(),r.text("").hide(),s.text("").hide(),n.dialog("open"))})),$(document).on("clearRegistrationTab",(function(e){r.text("").hide(),s.text("").hide(),u.prop("checked",!0),c.val("").removeClass("ok").focus()})),$(document).on("clearRegistrationErrors",(function(e){r.text("").hide(),s.text("").hide()})),c.on("input",(function(){o||i()})),x&&(l.on("captchaSuccess",(function(){j?t():e(),j=!1})),l.on("captchaError",(function(){r.text($.localize("Captcha error","~/js/area/account/register.js")).show(),l.removeAttr("disabled").text($.localize("Sign up","~/js/area/account/register.js")),o=!1,j=!1})),l.on("captchaReset",(function(){l.removeAttr("disabled").text($.localize("Sign up","~/js/area/account/register.js")),o=!1,j=!1}))),d.click((function(e){o||i()})),l.click((function(t){return t.preventDefault(),setYMMainCounter("registration_form_apply"),setGAMainCounter("registration_form","apply"),g.text("").hide(),p.text("").hide(),r.text("").hide(),s.text("").hide(),validateEmail($.trim(c.val()))?($(document).trigger("clearLoginTab"),!o&&(o=!0,l.attr("disabled","disabled").text($.localize("Sending email...","~/js/area/account/register.js")),x?(j=!1,grecaptcha.execute(n.find(".dialog-registration .g-recaptcha").data("widgetid"))):e(),!1)):void r.html($.localize("Wrong email.","~/js/area/account/register.js")).show()})),n.find(".dialog-registration").keypress((function(t){if(13==t.keyCode&&"textarea"!=t.target.type&&(0==d.length||d.is(":checked")))return t.preventDefault(),g.text("").hide(),p.text("").hide(),r.text("").hide(),s.text("").hide(),validateEmail($.trim(c.val()))?void(o||l.is(":disabled")||(o=!0,l.attr("disabled","disabled").text($.localize("Sending email...","~/js/area/account/register.js")),x?(j=!1,grecaptcha.execute(n.find(".dialog-registration .g-recaptcha").data("widgetid"))):e())):void r.html($.localize("Wrong email.","~/js/area/account/register.js")).show()})),$(document).on("click",".dialog-registration .already-in-use",(function(e){e.preventDefault(),a(),r.text("").hide(),r.text("").hide(),g.text("").hide(),p.text("").hide()})),$(document).on("click",".dialog-registration .not-verified",(function(e){e.preventDefault(),o||(o=!0,g.text("").hide(),p.text("").hide(),r.text("").hide(),r.text("").hide(),l.attr("disabled","disabled").text($.localize("Sending email...","~/js/area/account/register.js")),x?(j=!0,grecaptcha.execute(n.find(".dialog-registration .g-recaptcha").data("widgetid"))):t())})),function(){if("function"==typeof window.URL){var e=window.history.location||window.location,t=new URL(e);t.searchParams.get("register")&&(o||(w.tabs("option","active",1),g.text("").hide(),p.text("").hide(),r.text("").hide(),s.text("").hide(),n.dialog("open")),t.searchParams.delete("register"),history.replaceState(null,null,t))}}()})),$(document).ready((function(){function e(e){e.session&&$.ajax({type:"GET",url:"/account/vkontakte?uid="+e.session.mid+"&first_name="+e.session.user.first_name+"&last_name="+e.session.user.last_name+(null!=$loginReturnUrl?"&return_url="+$loginReturnUrl:""),success:function(e){location.reload(!0)}})}function t(){return null==$loginReturnUrl?"":"?returnUrl="+$loginReturnUrl}$vkAppId&&"undefined"!=typeof VK&&VK.init({apiId:$vkAppId}),$(".provider .vkontakte").click((function(){"undefined"!=typeof VK?(VK.Auth.login(e),setYMMainCounter("autho_form_vk"),setGAMainCounter("social_media","vk","main")):(new DialogHelper).modalText($.localize("VK server is currently unavailable. Please choose another one or try again later","~/js/common/openIdProviders.js"),null,null,"ap-header-dialog")})),$(".provider .yandex").click((function(){setYMMainCounter("autho_form_ya"),setGAMainCounter("social_media","ya","main"),window.open("/account/yandex"+t(),"contacts","location,width=700,height=700").focus()})),$(".provider .facebook").click((function(){setYMMainCounter("autho_form_fb"),setGAMainCounter("social_media","fb","main"),window.open("/account/facebook"+t(),"contacts","location,width=850,height=500").focus()})),$(".provider .google").click((function(){setYMMainCounter("autho_form_google"),setGAMainCounter("social_media","google","main"),window.open("/account/google"+t(),"contacts","location,width=850,height=500").focus()})),$(".provider .twitter").click((function(){window.open("/account/twitter"+t(),"contacts","location,width=850,height=500").focus()})),$(".provider .odnoklassniki").click((function(){setYMMainCounter("autho_form_ok"),setGAMainCounter("social_media","ok","main"),window.open("/account/odnoklassniki"+t(),"contacts","location,width=850,height=500").focus()})),$(".provider .liveid").click((function(){setYMMainCounter("autho_form_ms"),setGAMainCounter("social_media","ms","main"),window.open("/account/liveId"+t(),"contacts","location,width=850,height=500").focus()})),$(".provider .mailru").click((function(){setYMMainCounter("autho_form_mailru"),setGAMainCounter("social_media","mailru","main"),window.open("/account/mailRu"+t(),"contacts","location,width=850,height=500").focus()})),$(".provider .linkedin").click((function(){window.open("/account/linkedin"+t(),"contacts","location,width=850,height=500").focus()}))}));