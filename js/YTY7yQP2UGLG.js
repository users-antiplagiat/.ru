$(document).ready((function(){function e(){null!=f&&(clearTimeout(f),f=null),o>0?a():($(".tariff-validity").html(""),$(".tariff-validity").hide()),o>0&&s.length>0?$(".tariff-validity").qtip({content:{text:$.map(s,(function(e){var t=showShortDate(new Date(Date.parse(e.EndDate))),i=e.ChecksRemaining||0,a=$.localize("{0} check expires {1}, {0} checks expire {1}, {0} checks expire {1}","~/js/common/updateUserHeader.js",[i,t]);return getNumEnding(i,a.split(", ")),"<p>"+getNumEnding(i,a.split(", "))+"</p>"})).join("\n")},style:{classes:"qtip-ux qtip-version qtip-tariff ap-header-qtip",tip:{width:12}},position:{my:"top center",at:"bottom left",adjust:{y:0,x:7}},show:{event:"mouseover"},hide:{event:"mouseout"}}):$(".tariff-validity").attr("data-hasqtip")&&$(".tariff-validity").qtip("destroy")}function t(){n||(n=!0,$.ajax({type:"GET",url:"/api/billing/tariffinfo",dataType:"json",timeout:6e4,success:function(e){e&&i(e)},complete:function(e,t){n=!1}}))}function i(t){if(null!=t){$(".user-info-balance").find("strong").text(t.Amount),$(".user-info-balance").find("a").toggleClass("none",t.Amount<=0),$(".user-info-tariff").find("strong").text(t.TariffDisplayName),$(".user-info-tariff").find("#user-info-checks-left").text(t.ChecksRemaining||0),$(".user-info-tariff").find(".tariff-current").toggleClass("free",t.IsFree);var i=t.IsFree?$.localize("Change","~/js/common/updateUserHeader.js"):$.localize("Add","~/js/common/updateUserHeader.js");$(".user-info-tariff").find(".tariff-edit > a").text(i),$(".user-info-tariff").find(".tariff-edit > a").attr({title:i}),t.IsFree?0==$(".user-info-tariff").find(".tariff-current i.warning").length&&($(".user-info-tariff").find(".tariff-current").append('<i class="warning"></i>'),r()):($(".user-info-tariff").find(".tariff-current i.warning").qtip("destroy"),$(".user-info-tariff").find(".tariff-current i.warning").remove()),o=t.RemainingDurationMs,s=t.TariffsDetails||[],e()}}function a(){if(isNaN(o)||o<0)$(".tariff-validity").html(""),$(".tariff-validity").hide();else{var e=function(e){var t="",i=Math.floor(e/864e5);e-=864e5*i;var a=Math.floor(e/36e5);e-=36e5*a;var r=Math.floor(e/6e4);return e-=6e4*r,i>0&&(t+=i+$.localize("d","~/js/common/updateUserHeader.js")),i<7&&(t+=" "+a+$.localize("h","~/js/common/updateUserHeader.js")),i<=0&&(t+=" "+r+$.localize("m","~/js/common/updateUserHeader.js")),$.trim(t)}(o);$(".tariff-validity").html(e),$(".tariff-validity").show()}var i=1e3*(60-(new Date).getSeconds());f=(o-=i)>0?setTimeout(a,i):setTimeout(t,o+i+1)}function r(){$(".user-info-tariff .tariff-current.free > i").qtip({content:{text:$.localize("Free tariff warning message","~/js/common/updateUserHeader.js")},style:{classes:"qtip-ux qtip-version ap-header-qtip",tip:{corner:"left top",mimic:"left center",width:12,offset:5}},position:{my:"left top",at:"right center",adjust:{y:-8,x:0}},show:{event:"mouseover"},hide:{event:"mouseout"}})}var n=!1,f=null,o=parseInt($("#endTariffTime").val()),s=[];$("#endTariffTime").attr("data-details")&&(s=$("#endTariffTime").data("details")||[],$("#endTariffTime").removeAttr("data-details")),e(),r(),$(document).on("userInfoUpdated",(function(e){t()}))}));