var $loginReturnUrl=null;$(document).ready((function(){function t(){var t=null;p&&(t=grecaptcha.getResponse(n.find(".dialog-login .g-recaptcha").data("widgetid")));var e=$.toJSON({Email:$.trim(l.val()),Password:$.trim(s.val()),Captcha:t,ReturnUrl:$loginReturnUrl}),a=$("#__AjaxAntiForgeryForm").find("input[name='__RequestVerificationToken']").val();$.ajax({type:"POST",url:"/account/login",data:e,dataType:"json",beforeSend:function(t){t.setRequestHeader("X-RequestVerificationToken",a)},contentType:"application/json; charset=utf-8",success:function(t){p&&grecaptcha.reset(n.find(".dialog-login .g-recaptcha").data("widgetid")),t.success?null!=t.url?window.location.href=t.url:window.location.reload():("invalid role"==t.status?o.html(t.message+" <a href='/student'>"+$.localize("Sign in","~/js/area/account/login.js")+"</a>").show():o.html(t.message).show(),g.removeAttr("disabled").text($.localize("Sign in","~/js/area/account/login.js"))),i=!1},error:function(t,e,a){i=!1,g.removeAttr("disabled").text($.localize("Sign in","~/js/area/account/login.js")),500==t.status&&window.location.reload(!0),n.dialog("close"),(new DialogHelper).modalText($.localize("Sign in error.","~/js/area/account/login.js"))}})}function e(){i||(f.tabs("option","active",0),o.text("").hide(),r.text("").hide(),$(document).trigger("clearRegistrationErrors"),n.dialog("open"))}var i=!1,n=$("#dialog-enter"),a=n.find(".loading"),o=n.find(".dialog-login .alert-error"),r=n.find(".dialog-login .alert-success"),l=n.find('.dialog-login input[name^="Login.Email"]'),s=n.find('.dialog-login input[name^="Login.Password"]'),c=n.find("#tabs > ul > li:nth-child(2)"),g=n.find(".dialog-login .login-button > button"),d=n.find(".dialog-login #login-passwd-show"),u=$(".passwd-zone"),f=$(".dialog-enter #tabs"),p="undefined"!=typeof $showAccountCaptcha&&$showAccountCaptcha;$(document).on("click",".ap-dialog-enter-tabs .ui-tabs-nav li:eq(0)",(function(t){setYMMainCounter("autho_form_to_registration")})),$(document).on("click",".ap-dialog-enter-tabs .ui-tabs-nav li:eq(0) .manual, .ap-dialog-enter .ui-dialog-title .manual",(function(t){setYMMainCounter("autho_form_login_man"),setGAMainCounter("autho_form","login_manual")})),l.on("change",(function(t){setYMMainCounter("autho_form_email_typing"),setGAMainCounter("login_form","email_typing")})),s.on("change",(function(t){setYMMainCounter("autho_form_password_typing"),setGAMainCounter("login_form","password_typing")})),f.length>=1&&f.tabs({active:0,activate:function(t,e){var i=e.newTab.index()+1;$("#tabs-"+i).find("input[type='text']:first").focus()}});var h=n.find("h3 > span");h.qtip({content:{text:function(t){return $(this).find("i").html()}},style:{classes:"qtip-ux qtip-field-dialog qtip-login ap-header-qtip",tip:!0},position:{my:"center left",at:"center right"},show:{solo:!0,event:"mouseover"},hide:{event:"mouseout",fixed:!0},events:{show:function(t,e){e.target.is(":hidden")&&t.preventDefault()}}});var m=h.qtip("api"),b=!1;n.dialog({autoOpen:!1,resizable:!1,modal:!0,draggable:!1,autoresize:!0,dialogClass:"ap-header-dialog ap-dialog-confirm "+(0==f.length?"ap-dialog-enter":"ap-dialog-enter-tabs"),buttons:[],open:function(){if(g.removeAttr("disabled"),u.show(),c.css("pointer-events",""),0==f.length)l.focus();else{var t=f.tabs("option","active")+1;$("#tabs-"+t).find("input[type='text']:first").focus()}jQuery(".ui-widget-overlay").bind("click",(function(){i||n.dialog("close")}))},create:function(){p&&(g.on("captchaSuccess",t),g.on("captchaError",(function(){o.text($.localize("Captcha error","~/js/area/account/login.js")).show(),g.removeAttr("disabled").text($.localize("Sign in","~/js/area/account/login.js")),i=!1})),g.on("captchaReset",(function(){g.removeAttr("disabled").text($.localize("Sign in","~/js/area/account/login.js")),i=!1})))},beforeClose:function(){if(i)return!1},close:function(){$(document).trigger("clearLoginTab"),o.text("").hide(),r.text("").hide(),$(document).trigger("clearRegistrationTab"),$(document).trigger("clearRegistrationErrors"),$loginReturnUrl=null,a.hide(),null!=m&&m.hide(),p&&(n.find(".dialog-login .g-recaptcha").length>0&&grecaptcha.reset(n.find(".dialog-login .g-recaptcha").data("widgetid")),n.find(".dialog-registration .g-recaptcha").length>0&&grecaptcha.reset(n.find(".dialog-registration .g-recaptcha").data("widgetid")))},width:540,closeText:$.localize("Close","~/js/area/account/login.js")}),$(".enter .login, .start-free a, .section-access a.btn-submit-altr, .main-menu .enter-white").click((function(t){t.preventDefault(),t.stopPropagation(),i||($(this).is(".btn-submit-altr")?(setYMMainCounter("login_footer"),setGAMainCounter("login_signin","login","footer")):$(this).is(".login")?(setYMMainCounter("login_top"),setGAMainCounter("login_signin","login","top")):$(this).parent().is(".start-free")&&(setYMMainCounter("begin_for_free"),setGAMainCounter("login_signin","begin_for_free")),e())})),$(".ap-dialog-enter, .ap-dialog-enter-tabs").click((function(t){b&&(b=!1,t.target===h[0]&&t.stopPropagation())})),$(document).on("clearLoginTab",(function(t){l.val("").removeClass("ok").focus(),s.val("").attr("type","password"),null!=m&&g.attr("disabled","disabled")})),$(document).on("openLoginDialog",(function(t,i){var n=i||(t.originalEvent?t.originalEvent.detail:null);n&&($loginReturnUrl=n),e()})),g.click((function(e){if(e.preventDefault(),o.text("").hide(),r.text("").hide(),$(document).trigger("clearRegistrationTab"),$(document).trigger("clearRegistrationErrors"),!i)return setYMMainCounter("autho_form_apply"),setGAMainCounter("login_form","apply"),i=!0,g.attr("disabled","disabled").text($.localize("Signing in...","~/js/area/account/login.js")),p?grecaptcha.execute(n.find(".dialog-login .g-recaptcha").data("widgetid")):t(),!1})),n.find(".dialog-login").keypress((function(e){13==e.keyCode&&"textarea"!=e.target.type&&(e.preventDefault(),o.text("").hide(),r.text("").hide(),$(document).trigger("clearRegistrationErrors"),i||g.is(":disabled")||(i=!0,g.attr("disabled","disabled").text($.localize("Signing in...","~/js/area/account/login.js")),p?grecaptcha.execute(n.find(".dialog-login .g-recaptcha").data("widgetid")):t()))})),l.on("input",(function(){i||function(){var t=validateEmail($.trim(l.val()));null!=m&&(t?g.removeAttr("disabled"):g.attr("disabled","disabled")),l.toggleClass("ok",t)}()})),l.on("blur",(function(t){if(!i){var e=$(this),n=g.is(":disabled"),a=$.trim(e.val()).length>0&&n;b=a,null!=m&&m.toggle(a)}})),d.change((function(t){s.attr("type",$(this).is(":checked")?"text":"password"),setYMMainCounter("autho_form_show_password"),setGAMainCounter("login_form","show_password")})),function(){if("function"==typeof window.URL){var t=window.history.location||window.location,i=new URL(t);i.searchParams.get("login")&&(e(),i.searchParams.delete("login"),history.replaceState(null,null,i))}}()}));